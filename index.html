<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>NASA Command v1.7</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.104/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.104/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        #cesiumContainer { width: 100%; height: 100%; position: absolute; }
        
        /* HUD moved to the RIGHT to clear the search bar on the LEFT */
        #hud { 
            position: absolute; top: 10px; right: 10px; color: #00f2ff; 
            background: rgba(0,15,35,0.9); padding: 15px; z-index: 100; 
            font-family: 'Courier New', monospace; border: 1px solid #00f2ff; 
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.5); text-align: right;
            border-radius: 4px;
        }

        /* GPS Trigger styled as part of the satellite system */
        .gps-link {
            color: #00f2ff; text-decoration: none; font-weight: bold;
            display: block; margin-top: 8px; border-top: 1px solid #00f2ff;
            padding-top: 8px; cursor: pointer; font-size: 13px;
        }
        .gps-link:hover { color: lime; }

        /* Moves search results so they don't cover the screen center */
        .cesium-viewer-geocoderContainer { top: 10px; left: 10px; position: absolute; }
    </style>
</head>
<body>
    <div id="hud">
        <b>SATELLITE INTERFACE v1.7</b><br>
        <span id="status">SIGNAL: STABLE</span><br>
        <div id="coords" style="font-size: 10px; color: #aaa;">POS: SEARCHING...</div>
        <div class="gps-link" onclick="startGpsLock()">ðŸ“¡ INITIATE GPS LOCK</div>
    </div>
    
    <div id="cesiumContainer"></div>

    <script>
        const myToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI5OWViZTU0OS01ZDc2LTQ4NmQtYmRhMy04ZTU2MjA4MTkzMmQiLCJpZCI6MzczOTE1LCJpYXQiOjE3NjcyMDQxMzN9.dx0uUUh5Tombo75mdeWH7octN0XnaJyHiSHYLcrKgjQ';
        let viewer;

        async function init() {
            try {
                Cesium.Ion.defaultAccessToken = myToken.trim();

                viewer = new Cesium.Viewer('cesiumContainer', {
                    baseLayerPicker: false, animation: false, timeline: false,
                    geocoder: true,
                    terrainProvider: await Cesium.createWorldTerrainAsync()
                });

                // Visual Engine
                viewer.scene.skyAtmosphere = new Cesium.SkyAtmosphere();
                viewer.scene.globe.enableLighting = true;
                viewer.scene.screenSpaceCameraController.minimumZoomDistance = 200;

                const imagery = await Cesium.createWorldImageryAsync();
                viewer.imageryLayers.addImageryProvider(imagery);
                const buildings = await Cesium.createOsmBuildingsAsync();
                viewer.scene.primitives.add(buildings);

                // Live HUD Updates
                viewer.camera.changed.addEventListener(() => {
                    const lat = Cesium.Math.toDegrees(viewer.camera.positionCartographic.latitude).toFixed(4);
                    const lon = Cesium.Math.toDegrees(viewer.camera.positionCartographic.longitude).toFixed(4);
                    document.getElementById('coords').innerText = `LAT: ${lat} | LON: ${lon}`;
                });

            } catch (e) { console.error(e); }
        }

        function startGpsLock() {
            const status = document.getElementById('status');
            status.innerText = "SIGNAL: SCANNING...";
            
            const gpsOptions = {
                enableHighAccuracy: true, // Forces phone to use real GPS satellites
                timeout: 10000,           // Wait up to 10 seconds for a lock
                maximumAge: 0             // Do not use old "neighborhood" locations
            };

            navigator.geolocation.getCurrentPosition((pos) => {
                status.innerText = "SIGNAL: LOCKED";
                status.style.color = "lime";
                
                viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees(pos.coords.longitude, pos.coords.latitude, 600),
                    orientation: { pitch: Cesium.Math.toRadians(-45) },
                    duration: 4
                });
            }, (err) => {
                status.innerText = "SIGNAL: FAILED";
                status.style.color = "red";
                alert("GPS Error: Ensure location services are ON.");
            }, gpsOptions);
        }

        init();
    </script>
</body>
</html>
