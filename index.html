<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>NASA Satellite & 3D Command</title>
    
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.104/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.104/Build/Cesium/Cesium.js"></script>

    <style>
        body, html { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; }
        #cesiumContainer { width: 100%; height: 100%; }
        #hud {
            position: absolute; top: 15px; left: 15px; z-index: 10;
            background: rgba(0, 15, 30, 0.85); color: #00f2ff;
            padding: 12px; border: 1px solid #00f2ff;
            font-family: 'Segoe UI', Tahoma, sans-serif; border-radius: 4px;
            pointer-events: none; box-shadow: 0 0 15px rgba(0, 242, 255, 0.3);
        }
        .status-dot { color: #00ff00; font-weight: bold; }
    </style>
</head>
<body>

    <div id="hud">
        <div style="font-weight: bold; letter-spacing: 1px;">NASA COMMAND</div>
        <div style="font-size: 11px; opacity: 0.8;">Haines City Sector</div>
        <hr style="border: 0.5px solid #00f2ff; margin: 5px 0;">
        <div>STATUS: <span class="status-dot">‚óè ONLINE</span></div>
        <div id="objCount">SCANNING ASTEROIDS...</div>
    </div>

    <div id="cesiumContainer"></div>

    <script>
        // 1. ENGINE INITIALIZATION
        // We use OSM so you can zoom in all the way to your street
        const viewer = new Cesium.Viewer('cesiumContainer', {
            imageryProvider: new Cesium.OpenStreetMapImageryProvider({
                url: 'https://a.tile.openstreetmap.org/'
            }),
            terrainProvider: Cesium.createWorldTerrain(), // This adds 3D mountains
            baseLayerPicker: false,
            geocoder: true,
            homeButton: false,
            timeline: false,
            animation: false,
            sceneModePicker: true,
            navigationHelpButton: false
        });

        // 2. NASA REAL-TIME SATELLITE OVERLAY
        // This adds the clouds and "Realistic Earth" look on top of the map
        const nasaLayer = viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({
            url: "https://gibs.earthdata.nasa.gov/wmts/epsg4326/best/wmts.cgi?Service=WMTS&Request=GetTile&Version=1.0.0&Layer=MODIS_Terra_CorrectedReflectance_TrueColor&TileMatrixSet=250m&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&Style=default&Format=image/jpeg&Time=2025-12-30",
            layer: "MODIS_Terra_CorrectedReflectance_TrueColor",
            style: "default",
            format: "image/jpeg",
            tileMatrixSetID: "250m",
            maximumLevel: 8
        }));
        nasaLayer.alpha = 0.6; // 60% visibility so you can see streets through clouds

        // 3. 3D BUILDINGS LAYER
        // This generates the actual 3D building blocks in cities
        const buildings = viewer.scene.primitives.add(Cesium.createOsmBuildings());

        // 4. MOBILE CAMERA OPTIMIZATION
        // Stops the camera from flipping upside down on your phone
        viewer.scene.screenSpaceCameraController.enableLook = false;
        viewer.scene.screenSpaceCameraController.inertiaSpin = 0;
        viewer.scene.screenSpaceCameraController.minimumZoomDistance = 20; // Allows super close zoom

        // 5. STARTING POSITION (Haines City, FL)
        viewer.camera.flyTo({
            destination: Cesium.Cartesian3.fromDegrees(-81.6231, 28.1136, 2000),
            orientation: {
                pitch: Cesium.Math.toRadians(-35), // Angle to see 3D buildings
                heading: 0
            }
        });

        // 6. NASA ASTEROID DATA LINK
        async function fetchAsteroids() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch(`https://api.nasa.gov/neo/rest/v1/feed?start_date=${today}&end_date=${today}&api_key=DEMO_KEY`);
                const data = await response.json();
                const asteroids = data.near_earth_objects[today];
                
                document.getElementById('objCount').innerText = `ASTEROIDS: ${asteroids.length} DETECTED`;

                asteroids.forEach(neo => {
                    const dist = parseFloat(neo.close_approach_data[0].miss_distance.kilometers) / 1000;
                    const angle = Math.random() * Math.PI * 2;
                    viewer.entities.add({
                        name: neo.name,
                        position: Cesium.Cartesian3.fromElements(dist * Math.cos(angle), dist * Math.sin(angle), 5000000),
                        point: { pixelSize: 10, color: Cesium.Color.RED, outlineWidth: 2 }
                    });
                });
            } catch(e) { console.log("Asteroid Link Offline"); }
        }
        fetchAsteroids();

    </script>
</body>
</html>

